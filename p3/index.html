<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <link rel="shortcut icon" type="image/x-icon" href="/dwd/favicon.png">
  <link rel="icon" type="image/x-icon" href="/dwd/favicon.png">
  <title>
  Project3 - A Total Control Lighting Helper
  </title>

  <script src="../jquery-1.8.1.js" type="text/javascript"></script>
  <script src="../jquery-ui-1.8.23.custom/js/jquery-ui-1.8.23.custom.min.js"></script>

  <link rel="Stylesheet" type="text/css" href="../jpicker/css/jpicker-1.1.6.min.css" />
  <link rel="Stylesheet" type="text/css" href="../jpicker/jPicker.css" />
  <script src="../jpicker/jpicker-1.1.6.js" type="text/javascript"></script>


  <link rel="Stylesheet" type="text/css" href="tcl_helper.css" />
  <script src="tcl_helper.js" type="text/javascript"></script>

  <script type="text/javascript">

    var $diagram;
    var $brush_color;
    var standard_notice = 'Drag LEDs to position them.<br>Drag and drop palette pots on LEDS or click on a palette pot to color multiple LEDs.<br> Use the color picker to customize your palette.';

    function init() 
    {

      // initialize the palette
      var colors = [ "#000000", "#ffffff", 
        "#ff0000", "#bf00bf",
        "#0000ff", "#007fff",
        "#ffff00", "#ff7f00", "#bfbf00",
        "#00ff00", "#2a562a" ];
      for(var i = 0; i < colors.length; i++) {
        add_palette_pot("#palette1 ul", i, colors[i]);
      }

      // initialize the diagram
      $diagram = new diagram("diagram1", "frames1");
      $diagram.initialize(5);

      // make the frames sortable
      $("#frames1 ul").sortable();

      clear_notice();

      // set brush color on palette click
      $("div.pot").click( function() {
        notice("click on LEDs to color");
        $brush_color = $(this).css("background-color"); 
        // clear brush color when done
        $("#notice_done").show().click( function() {
          $brush_color = null; 
          clear_notice();
        });
      });

    }

    function notice(text)
    {
      $("#notices span")[0].innerHTML = text;
      $("#notices").effect("highlight", {}, 3000);
    }
    function clear_notice()
    {
      $("#notices span")[0].innerHTML = standard_notice;
      $("#notices button").hide();
    }

    $(document).ready(function()
    {
      init ();
    });

    function clear_current_frame()
    {
      $diagram.frame().initialize("#ffffff");
      $diagram.frame().display();
    }

    function play_frame(i, fids, delay)
    {
      $diagram.move_to_frame(fids[i]);
      if(i+1 < fids.length) {
        setTimeout(function() {
          play_frame(i+1, fids, delay);
        }, delay);
      }
    }
    function play(delay)
    {
      var frame_ids = $("div.frame").map(function() { return $(this).attr("frame_id"); } );
      play_frame(0, frame_ids, delay);
    }

    function export_colors()
    {
      $("#output").text($diagram.export());
    }

    function initialize_diagram()
    {
      var nleds = parseInt($("#led_input").val());
      $foo = nleds;
      if(isNaN(nleds) || nleds < 1) {
        alert("Please enter the number of LEDs.");
      } else {
        if(confirm("The diagram and all frames will be cleared.  Continue?")) {
          $diagram.initialize(nleds);
        }
      }
    }

  </script>

</head>
<body>

<div id="wrapper">
  <div>
    <p>Some stuff at the top.</p>
    <p>Some stuff at the top.</p>
    <p>Some stuff at the top.</p>
  </div>

  <div id="palette1" class="palette">
    <ul> </ul>
  </div>

  <div class="diagram_holder">

    <div class="buttons" >
      <label for="led_input" class="frame_op">Number of LEDs:</label>
      <input class="frame_op" type="text" id="led_input" />
      <button class="frame_op" onclick='initialize_diagram();'>Reset</button>
    </div>
    
    <div id="diagram1" class="diagram" width="600px" height="400px">
      <canvas class="diagram1_canvas" width="600px" height="400px"></canvas>
    </div>

    <div class="buttons" >
      <button class="frame_op" onclick='clear_current_frame();'>Clear Current Frame</button>
      <button class="frame_op" onclick='$diagram.append_frame();'>New frame</button>
      <button class="frame_op" onclick='$diagram.duplicate_frame();'>Duplicate frame</button>

      <button class="frameset_op" onclick='export_colors();'>Export</button>
      <button class="frameset_op" onclick='play(500);'>Play</button>
    </div>

    <div id="frames1" class="frameset">
      <ul> 
      </ul>
    </div>

    <div class="colordata" >
      <div class="buttons" >
        <button class="frameset_op" onclick='$("#output").focus().select();'>Select All</button>
      </div>
      <textarea id="output" rows=10 readonly="readonly"></textarea>
    </div>

  </div>

  <div id="notices" class="notice">
    <div>
    <span> 
    </span>
    </div>
    <button id="notice_cancel" onclick=''>Cancel</button>
    <button id="notice_done" onclick=''>Done</button>
    
  </div>

</div>

</body>
</html>
